---
title: "Testing Notes"
output: html_notebook
---

## Introduction

To automate our testing process, we utilized the testing framework 'testthat' package (ver. 3.1.4) in R (ver. 4.2.2). Following the 'testthat' framework, we created the recommended testing structure in which there is a "testthat" directory that lives in the "tests" directory.

All testing scripts and use case files (toy datasets) are set in the "testthat" directory

For each R script that generates a calculation or numerical output, there is a test in the "testthat" directory that checks the output of that function. For example, for a given R script such as "getCorrelationCoefficients_withinGroup.R", there is a test script in the "testthat" directory that directly checks this function: "test\_ getCorrelationCoefficients_withinGroup.R". In this file, the input files are both a toy counts table and metadata file.

### Running test scripts locally

The 'testthat' framework allows us to run either the entire testing directory (source_dir("tests/testthat)) or individual test files automatically (source_file("/test/getCorrelationCoefficients_withinGroup.R"). To run our tests locally, we recommend setting up your directory structure and nomenclature with the "testthat" folder nested into a "tests" folder, and then setting your R working directory to reflect this path.

Here is an example of running an individual test file with the "source" function.

```{r}
test_file("tests/testthat/test_getCorrelationCoefficient_withinGroup.R")
test_file("tests/testthat/test_getCorrelationCoefficient_acrossGroup.R")
test_file("tests/testthat/test_getCorrelationCoefficient_withinGroup_phylumLevel_byGroup.R")
test_file("tests/testthat/test_samplePairsAcrossGroup_NontransferringASVS_returnVectorsOnly.R")

```

To run all testing scripts within the directory, use the "test_dir" function.

```{r}
test_dir("./tests/testthat/")
```

### Replicating 'Plotmicrobiome' Figures

The alpha diversity plots were generated through the Plotmicrobiome application (developed by Shan Sun). We tested these figures by independently recreating these figures in R.

PCoA results were initially generated through the Plotmicrobiome Application as well, but for the final figure set, we independently recreated these plots for formatting purposes.

For some of the PCoA plots with specific sample groups (i.e. mice groups only), we multiplied either one or both of the MDS axes in order to perfectly replicate the Plotmicrobiome plot results. PERMANOVA R and p-values, as well as MDS percent variance were identical to the Plotmicrobiome plot results.

Figure replications for both alpha diversity and PCoA plots are PDF files within the "tests" directory.  


#### References

<https://testthat.r-lib.org/>

<https://www.r-bloggers.com/2019/11/automated-testing-with-testthat-in-practice/>
